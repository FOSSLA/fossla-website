---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { Icon } from "astro-icon/components";
import { getCollection } from "astro:content";

const typeColors: Record<string, string> = {
  Workshop: "bg-primary/20 text-primary border-primary/30",
  Meetup: "bg-blue-500/20 text-blue-400 border-blue-500/30",
  Hackathon: "bg-purple-500/20 text-purple-400 border-purple-500/30",
  Webinar: "bg-yellow-500/20 text-yellow-400 border-yellow-500/30"
};

const events = await getCollection("events");
const upcoming = events
  .filter((event) => event.data.status === "upcoming")
  .sort((a, b) => a.data.date.getTime() - b.data.date.getTime());
const past = events
  .filter((event) => event.data.status === "past")
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---
<BaseLayout title="Community Events" description="Join us for workshops, meetups, and collaborative learning experiences.">
  <section class="container mx-auto px-4 pt-24 pb-20">
    <div class="mx-auto mb-16 max-w-4xl text-center">
      <h1 class="mb-6 text-4xl font-bold md:text-5xl">
        Community <span class="text-primary">Events</span>
      </h1>
      <p class="text-xl text-muted-foreground">
        Join us for workshops, meetups, and collaborative learning experiences.
      </p>
    </div>

    <div class="mb-20">
      <h2 class="mb-8 text-3xl font-bold">Upcoming Events</h2>
      <div class="space-y-6">
        {upcoming.map((event) => (
          <article class="rounded border border-border bg-card/40 transition hover:border-primary/50">
            <div class="border-b border-border p-6">
              <div class="flex flex-col gap-4 md:flex-row md:items-start md:justify-between">
                <div>
                  <div class="mb-3 flex items-center gap-2">
                    <span class={`rounded border px-2 py-1 text-xs font-semibold ${typeColors[event.data.type]}`}>
                      {event.data.type}
                    </span>
                  </div>
                  <h3 class="mb-2 text-2xl font-semibold">{event.data.title}</h3>
                  <p class="text-muted-foreground">{event.data.description}</p>
                </div>
                <a href="https://forms.gle/fossla-events" class="h-fit rounded border border-primary bg-primary px-6 py-2 text-sm font-semibold text-primary-foreground">
                  Register Now
                </a>
              </div>
            </div>
            <div class="grid gap-4 p-6 text-sm text-muted-foreground md:grid-cols-4">
              <div class="flex items-center gap-2">
                <Icon name="lucide:calendar" class="h-4 w-4 text-primary" />
                {event.data.date.toLocaleDateString()}
              </div>
                <div class="flex items-center gap-2">
                  <Icon name="lucide:clock-3" class="h-4 w-4 text-primary" />
                  {event.data.time}
                </div>
              <div class="flex items-center gap-2">
                <Icon name="lucide:map-pin" class="h-4 w-4 text-primary" />
                {event.data.location}
              </div>
              <div class="flex items-center gap-2">
                <Icon name="lucide:users" class="h-4 w-4 text-primary" />
                {event.data.attendees} attending
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>

    <div>
      <h2 class="mb-8 text-3xl font-bold">Past Events</h2>
      <div class="grid gap-6 md:grid-cols-3">
        {past.map((event) => (
          <article class="rounded border border-border bg-card/40 p-6">
            <span class={`mb-3 inline-flex rounded border px-2 py-1 text-xs font-semibold ${typeColors[event.data.type]}`}>
              {event.data.type}
            </span>
            <h3 class="mb-3 text-xl font-semibold">{event.data.title}</h3>
            <div class="space-y-2 text-sm text-muted-foreground">
              <div class="flex items-center gap-2">
                <Icon name="lucide:calendar" class="h-4 w-4 text-primary" />
                {event.data.date.toLocaleDateString()}
              </div>
              <div class="flex items-center gap-2">
                <Icon name="lucide:clock-3" class="h-4 w-4 text-primary" />
                {event.data.time}
              </div>
              <div class="flex items-center gap-2">
                <Icon name="lucide:map-pin" class="h-4 w-4 text-primary" />
                {event.data.location}
              </div>
              <div class="flex items-center gap-2">
                <Icon name="lucide:users" class="h-4 w-4 text-primary" />
                {event.data.attendees} attended
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>

    <div class="mx-auto mt-20 max-w-4xl rounded border border-primary/30 bg-primary/5 p-8 text-center">
      <Icon name="lucide:calendar-days" class="mx-auto mb-4 h-12 w-12 text-primary" />
      <h3 class="mb-4 text-2xl font-bold">Want to propose a talk?</h3>
      <p class="mb-6 text-muted-foreground">Have an idea for a workshop, talk, or meetup? We'd love to help you make it happen.</p>
      <a href="mailto:events@fossla.org" class="rounded border border-primary bg-primary px-6 py-2 font-semibold text-primary-foreground">
        Propose an Event
      </a>
    </div>

    <div class="mx-auto mt-10 max-w-4xl rounded border border-primary/30 bg-card/40 p-8 text-center">
      <Icon name="lucide:handshake" class="mx-auto mb-4 h-12 w-12 text-primary" />
      <h3 class="mb-3 text-2xl font-bold">Sponsor an Event</h3>
      <p class="mb-6 text-muted-foreground">
        Help us keep workshops and meetups free for the community. Sponsor venue, connectivity, or prizes and we'll share the impact.
      </p>
      <div class="flex flex-col justify-center gap-3 sm:flex-row">
        <a href="/sponsor" class="rounded border border-primary bg-primary px-6 py-2 font-semibold text-primary-foreground hover:bg-primary/90">
          View Sponsorships
        </a>
        <a href="mailto:contact@fossla.org?subject=Sponsor%20an%20Event" class="rounded border border-border px-6 py-2 font-semibold text-foreground transition hover:border-primary">
          Email the Team
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
